(function () {
'use strict';

class Utils {
    constructor() {}

    static initTemplate(wrapperEl, templateId) {
        let template = document.querySelector(`#${templateId}`);
        let clon = template.content.cloneNode(true);
        wrapperEl.innerHTML = '';
        wrapperEl.appendChild(clon);
    }

    static setActiveLink(elem, object) {
        object.forEach(item => {
            if (item == elem) {
                item.classList.add("active");
            } else {
                item.classList.remove("active");
            }
        });
    }

    static navigateTo(routeName) {
        window.location.hash = "#" + routeName;
    }

    static isLoggedIn() {
        let credentials = JSON.parse(localStorage.getItem('credentials'));
        return !!credentials;
    }

    static setLocalStorage(value, key) {
        localStorage.setItem(value, key);
    }

    static getLocalStorage(value) {
        return localStorage.getItem(value);
    }
}

class LoginModel {
    constructor() {
        this.userUrl = 'https://gist.githubusercontent.com/Igor-Garnik/4393129d0e1985c5fb76d3d84a38a1db/raw/ae59f915950daa2e9d673db9534d2c4009cb9aa5/admin-user';
        this.emailPattern = /^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/;
        this.passwordPattern = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,12}$/;
        this.errorMsg = null;
        this.errorsMsgList = {
            "empty": 'Пожалуйста заполните поля логин и пароль',
            "logError": 'Логин введен неверно. Только латинские буквы.',
            "passError": 'Пароль введен неверно. Тольк латинские буквы, цифры. Длина не менее 8 символов',
            "missmatch": 'Неправильные логин или пароль.'
        };
    }

    validate(credentials) {
        return this.isEmpty(credentials) && this.isEmailMissmatchPattern(credentials) && this.isPasswordMissmatchPattern(credentials);
    }

    isEmpty(credentials) {
        return credentials.login && credentials.password || this.setErrorMsg("empty");
    }

    isEmailMissmatchPattern(credentials) {
        return this.emailPattern.test(cradentials.login) || this.setErrorMsg("logError");
    }

    isPasswordMissmatchPattern(credentials) {
        return this.passwordPattern.test(credentials.password) || this.setErrorMsg("passError");
    }

    setErrorMsg(key) {
        this.errorMsg = this.errorsMsgList[key];
        return false;
    }

    getErrorMsg() {
        return this.errorMsg;
    }

    login(credentials) {
        let options = {
            headers: {
                'Content-type': 'application/json; charset=utf-8'
            },
            method: 'post',
            body: JSON.stringify(credentials)
        };
        return fetch(this.userUrl, options).then(responce => responce.json()).then(data => {
            if (data.loginStatus) {
                localStorage.setItem('credentials', JSON.stringify(credentials));
            } else {
                this.setErrorMsg("missmatch");
            }
            return data;
        });
    }

    logOut() {
        localStorage.removeItem('credentials');
    }

}

class LoginView {
    constructor() {
        this.domElements = {
            "logInBtn": document.querySelector("#log-in-btn"),
            "logOutBtn": document.querySelector("#log-out-btn"),
            "login": document.querySelector("#inputEmail"),
            "password": document.querySelector("#inputPassword"),
            "navigationPanel": document.querySelector("#top-panel-navigation"),

            "showPasswordBtn": document.querySelector("#show-password"),
            "loginForm": document.querySelector("#login-form"),
            "alertWindow": document.querySelector(".alert-window"),
            "galleryWindow": document.querySelector(".gallery-window"),
            "userWindow": document.querySelector(".user-window"),
            "mainMenu": document.querySelector(".main-menu"),
            "inputPassword": document.querySelector("#otputPassword"),
            "inputEmail": document.querySelector("#otputEmail")

        };
    }

    getCradentials() {
        return {
            login: this.domElements.login.value,
            password: this.domElements.password.value
        };
    }

    hideMsg() {
        this.domElements.alertWindow.classList.add("hide");
    }

    showNavigation() {
        this.domElements.navigationPanel.classList.remove("hide");
    }

    hideLogout() {
        this.domElements.navigationPanel.classList.add("hide");
    }

}

class LoginController {
    constructor(model, view, utils) {
        this.model = model;
        this.view = view;
        this.util = utils;
        this.init();
    }

    init() {
        this.initListeners();
    }

    initListeners() {
        this.view.domElements.logInBtn.addEventListener('click', this.loginHandler.bind(this));
        this.view.domElements.logOutBtn.addEventListener('click', this.logOutHandler.bind(this));
    }

    loginHandler(e) {
        e.preventDefault();
        let credentials = this.view.getCredentials();
        if (this.model.validate(credentials)) {
            this.model.login(credentials).then(data => {
                if (data.liginSatus) {
                    this.view.hideMsg();
                    this.view.showNavigation();
                    this.utils.navigateTo("gallery");
                }
            });
        }
    }

    logOutHandler() {
        this.view.hideNavigation();
        this.model.logOut();
        this.utils.navigateTo("");
    }

}

let wraper = document.querySelector("#wrapper");
let usersLisr = "https://gist.githubusercontent.com/Igor-Garnik/7bcff581fb9f75cd21b6a5653a626ce6/raw/6439cf4ca5f8f3136be569716dbe422c4595a4b5/users-list";

let routeConfig = {
    "": () => {
        Utils.initTemplate(wrapper, "login-view");
        let model = new LoginModel(usersLisr);
        let view = new LoginView();
        let controller = new LoginController(model, view, Utils);
    },
    "gallery": () => {
        Utils.initTemplate(wrapper, "gallery-view");
        let observer = new Observer();
    },
    "profile": () => {
        Utils.initTemplate(wrapper, "profile-view");
    }
};

function activateRoute(routeName) {
    let route = routeConfig[routeName];
    route && route();
}

function updateRoute() {
    let routeName = document.location.hash.replace(/^#/, '');
    if (routeName) {
        Utils.navigateTo(routeName);
        activateRoute(routeName);
    } else {
        activateRoute(routeName);
    }
}

window.addEventListener('load', updateRoute);
window.addEventListener('hashchange', updateRoute);

}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwibG9naW4vbG9naW4ubW9kZWwuanMiLCJsb2dpbi9sb2dpbi52aWV3LmpzIiwibG9naW4vbG9naW4uY29udHJvbGxlci5qcyIsInJvdXRlci5qcyIsImFwcC5qcyJdLCJuYW1lcyI6WyJVdGlscyIsImluaXRUZW1wbGF0ZSIsIndyYXBwZXJFbCIsInRlbXBsYXRlSWQiLCJ0ZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNsb24iLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiaW5uZXJIVE1MIiwiYXBwZW5kQ2hpbGQiLCJzZXRBY3RpdmVMaW5rIiwiZWxlbSIsIm9iamVjdCIsImZvckVhY2giLCJpdGVtIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwibmF2aWdhdGVUbyIsInJvdXRlTmFtZSIsImxvY2F0aW9uIiwiaGFzaCIsImlzTG9nZ2VkSW4iLCJjcmVkZW50aWFscyIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRMb2NhbFN0b3JhZ2UiLCJ2YWx1ZSIsImtleSIsInNldEl0ZW0iLCJnZXRMb2NhbFN0b3JhZ2UiLCJMb2dpbk1vZGVsIiwidXNlclVybCIsImVtYWlsUGF0dGVybiIsInBhc3N3b3JkUGF0dGVybiIsImVycm9yTXNnIiwiZXJyb3JzTXNnTGlzdCIsImlzRW1wdHkiLCJpc0VtYWlsTWlzc21hdGNoUGF0dGVybiIsImlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuIiwibG9naW4iLCJwYXNzd29yZCIsInNldEVycm9yTXNnIiwidGVzdCIsImNyYWRlbnRpYWxzIiwib3B0aW9ucyIsInN0cmluZ2lmeSIsImZldGNoIiwidGhlbiIsInJlc3BvbmNlIiwianNvbiIsImRhdGEiLCJsb2dpblN0YXR1cyIsInJlbW92ZUl0ZW0iLCJMb2dpblZpZXciLCJkb21FbGVtZW50cyIsImFsZXJ0V2luZG93IiwibmF2aWdhdGlvblBhbmVsIiwiTG9naW5Db250cm9sbGVyIiwibW9kZWwiLCJ2aWV3IiwidXRpbHMiLCJ1dGlsIiwiaW5pdCIsImluaXRMaXN0ZW5lcnMiLCJsb2dJbkJ0biIsImFkZEV2ZW50TGlzdGVuZXIiLCJsb2dpbkhhbmRsZXIiLCJiaW5kIiwibG9nT3V0QnRuIiwibG9nT3V0SGFuZGxlciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImdldENyZWRlbnRpYWxzIiwidmFsaWRhdGUiLCJsaWdpblNhdHVzIiwiaGlkZU1zZyIsInNob3dOYXZpZ2F0aW9uIiwiaGlkZU5hdmlnYXRpb24iLCJsb2dPdXQiLCJ3cmFwZXIiLCJ1c2Vyc0xpc3IiLCJyb3V0ZUNvbmZpZyIsIndyYXBwZXIiLCJjb250cm9sbGVyIiwib2JzZXJ2ZXIiLCJPYnNlcnZlciIsImFjdGl2YXRlUm91dGUiLCJyb3V0ZSIsInVwZGF0ZVJvdXRlIiwicmVwbGFjZSIsIndpbmRvdyJdLCJtYXBwaW5ncyI6Ijs7O0FBQWUsTUFBTUEsS0FBTixDQUFZO2tCQUNUOztXQUVQQyxZQUFQLENBQW9CQyxTQUFwQixFQUErQkMsVUFBL0IsRUFBMkM7WUFDbkNDLFdBQVdDLFNBQVNDLGFBQVQsQ0FBd0IsSUFBR0gsVUFBVyxFQUF0QyxDQUFmO1lBQ0lJLE9BQU9ILFNBQVNJLE9BQVQsQ0FBaUJDLFNBQWpCLENBQTJCLElBQTNCLENBQVg7a0JBQ1VDLFNBQVYsR0FBc0IsRUFBdEI7a0JBQ1VDLFdBQVYsQ0FBc0JKLElBQXRCOzs7V0FHR0ssYUFBUCxDQUFxQkMsSUFBckIsRUFBMEJDLE1BQTFCLEVBQWtDO2VBQ3ZCQyxPQUFQLENBQWVDLFFBQVE7Z0JBQ2hCQSxRQUFRSCxJQUFYLEVBQWlCO3FCQUNSSSxTQUFMLENBQWVDLEdBQWYsQ0FBbUIsUUFBbkI7YUFESixNQUVPO3FCQUNFRCxTQUFMLENBQWVFLE1BQWYsQ0FBc0IsUUFBdEI7O1NBSlI7OztXQVNHQyxVQUFQLENBQWtCQyxTQUFsQixFQUE2QjtlQUNsQkMsUUFBUCxDQUFnQkMsSUFBaEIsR0FBc0IsTUFBTUYsU0FBNUI7OztXQUdHRyxVQUFQLEdBQW9CO1lBQ1pDLGNB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SCxFQUFjO2NBQ0pELFVBQU4sQ0FBaUJDLFNBQWpCO3NCQUNjQSxTQUFkO0tBRkosTUFHTztzQkFDV0EsU0FBZDs7OztBQ2pEUjBFLE9BQU96QixnQkFBUCxDQUF3QixNQUF4QixFQUFnQ3VCLFdBQWhDO0FBQ0FFLE9BQU96QixnQkFBUCxDQUF3QixZQUF4QixFQUFzQ3VCLFdBQXRDIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBVdGlscyB7XG4gICAgY29uc3RydWN0b3IgKCl7fVxuXG4gICAgc3RhdGljIGluaXRUZW1wbGF0ZSh3cmFwcGVyRWwsIHRlbXBsYXRlSWQpIHtcbiAgICAgICAgbGV0IHRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7dGVtcGxhdGVJZH1gKTtcbiAgICAgICAgbGV0IGNsb24gPSB0ZW1wbGF0ZS5jb250ZW50LmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgd3JhcHBlckVsLmlubmVySFRNTCA9ICcnO1xuICAgICAgICB3cmFwcGVyRWwuYXBwZW5kQ2hpbGQoY2xvbik7XG4gICAgfVxuXG4gICAgc3RhdGljIHNldEFjdGl2ZUxpbmsoZWxlbSxvYmplY3QpIHtcbiAgICAgICAgb2JqZWN0LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpZihpdGVtID09IGVsZW0pIHtcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBzdGF0aWMgbmF2aWdhdGVUbyhyb3V0ZU5hbWUpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2g9IFwiI1wiICsgcm91dGVOYW1lO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc0xvZ2dlZEluKCkge1xuICAgICAgICBsZXQgY3JlZGVudGlhbHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjcmVkZW50aWFscycpKTtcbiAgICAgICAgcmV0dXJuICEhY3JlZGVudGlhbHM7XG4gICAgfVxuXG4gICAgc3RhdGljIHNldExvY2FsU3RvcmFnZSAodmFsdWUsIGtleSkge1xuXHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKHZhbHVlLCBrZXkpO1xuXHR9XG5cblx0c3RhdGljIGdldExvY2FsU3RvcmFnZSAodmFsdWUpIHtcblx0XHRyZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0odmFsdWUpO1xuXHR9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9naW5Nb2RlbCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudXNlclVybCA9ICdodHRwczovL2dpc3QuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0lnb3ItR2FybmlrLzQzOTMxMjlkMGUxOTg1YzVmYjc2ZDNkODRhMzhhMWRiL3Jhdy9hZTU5ZjkxNTk1MGRhYTJlOWQ2NzNkYjk1MzRkMmM0MDA5Y2I5YWE1L2FkbWluLXVzZXInIFxuICAgICAgICB0aGlzLmVtYWlsUGF0dGVybiA9ICAvXihbYS16MC05Xy1dK1xcLikqW2EtejAtOV8tXStAW2EtejAtOV8tXSsoXFwuW2EtejAtOV8tXSspKlxcLlthLXpdezIsNn0kLztcbiAgICAgICAgdGhpcy5wYXNzd29yZFBhdHRlcm4gPSAvXig/PS4qXFxkKSg/PS4qW2Etel0pKD89LipbQS1aXSlbMC05YS16QS1aXXs4LDEyfSQvO1xuICAgICAgICB0aGlzLmVycm9yTXNnID0gbnVsbDtcbiAgICAgICAgdGhpcy5lcnJvcnNNc2dMaXN0ID0ge1xuICAgICAgICAgICAgXCJlbXB0eVwiICAgICA6ICfQn9C+0LbQsNC70YPQudGB0YLQsCDQt9Cw0L/QvtC70L3QuNGC0LUg0L/QvtC70Y8g0LvQvtCz0LjQvSDQuCDQv9Cw0YDQvtC70YwnLFxuICAgICAgICAgICAgXCJsb2dFcnJvclwiICA6ICfQm9C+0LPQuNC9INCy0LLQtdC00LXQvSDQvdC10LLQtdGA0L3Qvi4g0KLQvtC70YzQutC+INC70LDRgtC40L3RgdC60LjQtSDQsdGD0LrQstGLLicsXG4gICAgICAgICAgICBcInBhc3NFcnJvclwiIDogJ9Cf0LDRgNC+0LvRjCDQstCy0LXQtNC10L0g0L3QtdCy0LXRgNC90L4uINCi0L7Qu9GM0Log0LvQsNGC0LjQvdGB0LrQuNC1INCx0YPQutCy0YssINGG0LjRhNGA0YsuINCU0LvQuNC90LAg0L3QtSDQvNC10L3QtdC1IDgg0YHQuNC80LLQvtC70L7QsicsXG4gICAgICAgICAgICBcIm1pc3NtYXRjaFwiIDogJ9Cd0LXQv9GA0LDQstC40LvRjNC90YvQtSDQu9C+0LPQuNC9INC40LvQuCDQv9Cw0YDQvtC70YwuJ1xuICAgICAgICB9O1xuICAgIH1cblxuXHR2YWxpZGF0ZShjcmVkZW50aWFscykge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0VtcHR5KGNyZWRlbnRpYWxzKVxuICAgICAgICAmJiB0aGlzLmlzRW1haWxNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKVxuICAgICAgICAmJiB0aGlzLmlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKTtcbiAgICB9XG5cbiAgICBpc0VtcHR5KGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHJldHVybiAoY3JlZGVudGlhbHMubG9naW4gJiYgY3JlZGVudGlhbHMucGFzc3dvcmQpIHx8IHRoaXMuc2V0RXJyb3JNc2coXCJlbXB0eVwiKTtcbiAgICB9XG5cbiAgICBpc0VtYWlsTWlzc21hdGNoUGF0dGVybihjcmVkZW50aWFscykge1xuICAgICAgICByZXR1cm4gdGhpcy5lbWFpbFBhdHRlcm4udGVzdChjcmFkZW50aWFscy5sb2dpbikgfHwgdGhpcy5zZXRFcnJvck1zZyhcImxvZ0Vycm9yXCIpO1xuICAgIH1cblxuICAgIGlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhc3N3b3JkUGF0dGVybi50ZXN0KGNyZWRlbnRpYWxzLnBhc3N3b3JkKSB8fCB0aGlzLnNldEVycm9yTXNnKFwicGFzc0Vycm9yXCIpXG4gICAgfVxuXG4gICAgc2V0RXJyb3JNc2coa2V5KSB7XG4gICAgICAgIHRoaXMuZXJyb3JNc2cgPSB0aGlzLmVycm9yc01zZ0xpc3Rba2V5XTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGdldEVycm9yTXNnKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yTXNnO1xuICAgIH1cblxuICAgIGxvZ2luKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGNyZWRlbnRpYWxzKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZmV0Y2godGhpcy51c2VyVXJsLCBvcHRpb25zKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uY2UgPT4gcmVzcG9uY2UuanNvbigpKVxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubG9naW5TdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NyZWRlbnRpYWxzJywgSlNPTi5zdHJpbmdpZnkoY3JlZGVudGlhbHMpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVycm9yTXNnKFwibWlzc21hdGNoXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgbG9nT3V0KCkge1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY3JlZGVudGlhbHMnKTtcbiAgICB9XG5cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBMb2dpblZpZXcge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnRzID0ge1xuICAgICAgICAgICAgXCJsb2dJbkJ0blwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvZy1pbi1idG5cIiksXG4gICAgICAgICAgICBcImxvZ091dEJ0blwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvZy1vdXQtYnRuXCIpLFxuICAgICAgICAgICAgXCJsb2dpblwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2lucHV0RW1haWxcIiksXG4gICAgICAgICAgICBcInBhc3N3b3JkXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRQYXNzd29yZFwiKSxcbiAgICAgICAgICAgIFwibmF2aWdhdGlvblBhbmVsXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdG9wLXBhbmVsLW5hdmlnYXRpb25cIiksXG5cblxuICAgICAgICAgICAgXCJzaG93UGFzc3dvcmRCdG5cIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzaG93LXBhc3N3b3JkXCIpLFxuICAgICAgICAgICAgXCJsb2dpbkZvcm1cIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsb2dpbi1mb3JtXCIpLFxuICAgICAgICAgICAgXCJhbGVydFdpbmRvd1wiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmFsZXJ0LXdpbmRvd1wiKSxcbiAgICAgICAgICAgIFwiZ2FsbGVyeVdpbmRvd1wiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnktd2luZG93XCIpLFxuICAgICAgICAgICAgXCJ1c2VyV2luZG93XCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudXNlci13aW5kb3dcIiksXG4gICAgICAgICAgICBcIm1haW5NZW51XCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWFpbi1tZW51XCIpLFxuICAgICAgICAgICAgXCJpbnB1dFBhc3N3b3JkXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjb3RwdXRQYXNzd29yZFwiKSxcbiAgICAgICAgICAgIFwiaW5wdXRFbWFpbFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI290cHV0RW1haWxcIiksXG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldENyYWRlbnRpYWxzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbG9naW46IHRoaXMuZG9tRWxlbWVudHMubG9naW4udmFsdWUsXG4gICAgICAgICAgICBwYXNzd29yZDogdGhpcy5kb21FbGVtZW50cy5wYXNzd29yZC52YWx1ZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGlkZU1zZygpIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50cy5hbGVydFdpbmRvdy5jbGFzc0xpc3QuYWRkKFwiaGlkZVwiKTtcbiAgICB9XG5cbiAgICBzaG93TmF2aWdhdGlvbigpIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50cy5uYXZpZ2F0aW9uUGFuZWwuY2xhc3NMaXN0LnJlbW92ZShcImhpZGVcIik7XG4gICAgfVxuXG4gICAgaGlkZUxvZ291dCgpIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50cy5uYXZpZ2F0aW9uUGFuZWwuY2xhc3NMaXN0LmFkZChcImhpZGVcIik7XG4gICAgfVxuICAgXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9naW5Db250cm9sbGVyIHtcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbCwgdmlldywgdXRpbHMpIHtcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICB0aGlzLnZpZXcgPSB2aWV3O1xuICAgICAgICB0aGlzLnV0aWwgPSB1dGlscztcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuXG4gICAgaW5pdCgpIHtcbiAgICAgICAgdGhpcy5pbml0TGlzdGVuZXJzKCk7XG4gICAgfVxuXG4gICAgaW5pdExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy52aWV3LmRvbUVsZW1lbnRzLmxvZ0luQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5sb2dpbkhhbmRsZXIuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMudmlldy5kb21FbGVtZW50cy5sb2dPdXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmxvZ091dEhhbmRsZXIuYmluZCh0aGlzKSlcbiAgICB9XG5cbiAgICBsb2dpbkhhbmRsZXIoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGxldCBjcmVkZW50aWFscyA9IHRoaXMudmlldy5nZXRDcmVkZW50aWFscygpO1xuICAgICAgICBpZih0aGlzLm1vZGVsLnZhbGlkYXRlKGNyZWRlbnRpYWxzKSkge1xuICAgICAgICAgICAgdGhpcy5tb2RlbC5sb2dpbihjcmVkZW50aWFscykudGhlbihcbiAgICAgICAgICAgICAgICBkYXRhID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZGF0YS5saWdpblNhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXcuaGlkZU1zZygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3LnNob3dOYXZpZ2F0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnV0aWxzLm5hdmlnYXRlVG8oXCJnYWxsZXJ5XCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgbG9nT3V0SGFuZGxlcigpIHtcbiAgICAgICAgdGhpcy52aWV3LmhpZGVOYXZpZ2F0aW9uKCk7XG4gICAgICAgIHRoaXMubW9kZWwubG9nT3V0KCk7XG4gICAgICAgIHRoaXMudXRpbHMubmF2aWdhdGVUbyhcIlwiKTtcbiAgICB9XG5cbn0iLCJpbXBvcnQgdXRpbHMgZnJvbSAnLi91dGlscy5qcyc7XG5cbmltcG9ydCBHYWxsZXJ5TW9kZWwgZnJvbSAnLi9nYWxsZXJ5L2dhbGxlcnkubW9kZWwuanMnO1xuaW1wb3J0IEdhbGxlcnlWaWV3IGZyb20gJy4vZ2FsbGVyeS9nYWxsZXJ5LnZpZXcuanMnO1xuaW1wb3J0IEdhbGxlcnlDb250cm9sbGVyIGZyb20gJy4vZ2FsbGVyeS9nYWxsZXJ5LmNvbnRyb2xsZXIuanMnO1xuXG5pbXBvcnQgTG9naW5Nb2RlbCBmcm9tICcuL2xvZ2luL2xvZ2luLm1vZGVsLmpzJztcbmltcG9ydCBMb2dpblZpZXcgZnJvbSAnLi9sb2dpbi9sb2dpbi52aWV3LmpzJztcbmltcG9ydCBMb2dpbkNvbnRyb2xsZXIgZnJvbSAnLi9sb2dpbi9sb2dpbi5jb250cm9sbGVyLmpzJztcblxuaW1wb3J0IFByb2ZpbGVNb2RlbCBmcm9tICcuL3Byb2ZpbGUvcHJvZmlsZS5tb2RlbC5qcyc7XG5pbXBvcnQgUHJvZmlsZVZpZXcgZnJvbSAnLi9wcm9maWxlL3Byb2ZpbGUudmlldy5qcyc7XG5pbXBvcnQgUHJvZmlsZUNvbnRyb2xsZXIgZnJvbSAnLi9wcm9maWxlL3Byb2ZpbGUuY29udHJvbGxlci5qcydcblxubGV0IHdyYXBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd3JhcHBlclwiKTtcbmxldCBjYXJzTGlzdCA9IFwiaHR0cHM6Ly9naXN0LmdpdGh1YnVzZXJjb250ZW50LmNvbS9JZ29yLUdhcm5pay8wMzliNDEyN2I0ZmVhOWVkZGYxYjg3NjBhMWNiYzNkNC9yYXcvZWM1MjM1NjdlYWExZWFmMGZhNTdjOThkY2ExZjg1MTFiMDFiYzFkYi9jYXJzLWxpc3RcIjtcbmxldCB1c2Vyc0xpc3IgPSBcImh0dHBzOi8vZ2lzdC5naXRodWJ1c2VyY29udGVudC5jb20vSWdvci1HYXJuaWsvN2JjZmY1ODFmYjlmNzVjZDIxYjZhNTY1M2E2MjZjZTYvcmF3LzY0MzljZjRjYTVmOGYzMTM2YmU1Njk3MTZkYmU0MjJjNDU5NWE0YjUvdXNlcnMtbGlzdFwiO1xuXG5sZXQgcm91dGVDb25maWcgPSB7XG4gICAgXCJcIiA6ICgpID0+IHtcbiAgICAgICAgdXRpbHMuaW5pdFRlbXBsYXRlKHdyYXBwZXIsIFwibG9naW4tdmlld1wiKTtcbiAgICAgICAgbGV0IG1vZGVsID0gbmV3IExvZ2luTW9kZWwodXNlcnNMaXNyKTtcbiAgICAgICAgbGV0IHZpZXcgPSBuZXcgTG9naW5WaWV3O1xuICAgICAgICBsZXQgY29udHJvbGxlciA9IG5ldyBMb2dpbkNvbnRyb2xsZXIobW9kZWwsIHZpZXcsIHV0aWxzKTtcbiAgICB9LCBcbiAgICBcImdhbGxlcnlcIiA6ICgpID0+IHtcbiAgICAgICAgdXRpbHMuaW5pdFRlbXBsYXRlKHdyYXBwZXIsIFwiZ2FsbGVyeS12aWV3XCIpO1xuICAgICAgICBsZXQgbW9kZWwgPSBuZXcgR2FsbGVyeU1vZGVsKGNhcnNMaXN0KTtcbiAgICAgICAgbGV0IHZpZXcgPSBuZXcgR2FsbGVyeVZpZXc7XG4gICAgICAgIGxldCBvYnNlcnZlciA9IG5ldyBPYnNlcnZlcjtcbiAgICAgICAgbmV3IEdhbGxlcnlDb250cm9sbGVyKG1vZGVsLCB2aWV3LCBvYnNlcnZlciwgdXRpbHMpO1xuICAgIH0sXG4gICAgXCJwcm9maWxlXCIgOiAoKSA9PiB7XG4gICAgICAgIHV0aWxzLmluaXRUZW1wbGF0ZSh3cmFwcGVyLCBcInByb2ZpbGUtdmlld1wiKTtcbiAgICAgICAgbGV0IG1vZGVsID0gbmV3IFByb2ZpbGVNb2RlbCh1c2Vyc0xpc3QpO1xuICAgICAgICBsZXQgdmlldyA9IG5ldyBQcm9maWxlVmlldztcbiAgICAgICAgbmV3IFByb2ZpbGVDb250cm9sbGVyKG1vZGVsLCB2aWV3LCB1dGlscyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBhY3RpdmF0ZVJvdXRlKHJvdXRlTmFtZSl7XG4gICAgbGV0IHJvdXRlID0gcm91dGVDb25maWdbcm91dGVOYW1lXTtcbiAgICByb3V0ZSAmJiByb3V0ZSgpOyAgICBcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJvdXRlKCkge1xuICAgIGxldCByb3V0ZU5hbWUgPSBkb2N1bWVudC5sb2NhdGlvbi5oYXNoLnJlcGxhY2UoL14jLywgJycpO1xuICAgIGlmKHJvdXRlTmFtZSkge1xuICAgICAgICB1dGlscy5uYXZpZ2F0ZVRvKHJvdXRlTmFtZSk7IFxuICAgICAgICBhY3RpdmF0ZVJvdXRlKHJvdXRlTmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgYWN0aXZhdGVSb3V0ZShyb3V0ZU5hbWUpO1xuICAgIH1cbn0iLCJpbXBvcnQgeyB1cGRhdGVSb3V0ZSB9IGZyb20gJy4vcm91dGVyLmpzJ1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIHVwZGF0ZVJvdXRlKTtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdoYXNoY2hhbmdlJywgdXBkYXRlUm91dGUpOyJdfQ==
