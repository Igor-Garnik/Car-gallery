(function () {
'use strict';

class Utils {
    constructor() {}

    static initTemplate(wrapperEl, templateId) {
        let template = document.querySelector(`#${templateId}`);
        let clon = template.content.cloneNode(true);
        wrapperEl.innerHTML = '';
        wrapperEl.appendChild(clon);
    }

    static setActiveLink(elem, object) {
        object.forEach(item => {
            if (item == elem) {
                item.classList.add("active");
            } else {
                item.classList.remove("active");
            }
        });
    }

    static navigateTo(routeName) {
        window.location.hash = "#" + routeName;
    }

    static isLoggedIn() {
        let credentials = JSON.parse(localStorage.getItem('credentials'));
        return !!credentials;
    }

    static setLocalStorage(value, key) {
        localStorage.setItem(value, key);
    }

    static getLocalStorage(value) {
        return localStorage.getItem(value);
    }
}

class LoginModel {
    constructor() {
        this.userUrl = 'https://gist.githubusercontent.com/Igor-Garnik/4393129d0e1985c5fb76d3d84a38a1db/raw/ae59f915950daa2e9d673db9534d2c4009cb9aa5/admin-user';
        this.emailPattern = /^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/;
        this.passwordPattern = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,12}$/;
        this.errorMsg = null;
        this.errorsMsgList = {
            "empty": 'Пожалуйста заполните поля логин и пароль',
            "logError": 'Логин введен неверно. Только латинские буквы.',
            "passError": 'Пароль введен неверно. Тольк латинские буквы, цифры. Длина не менее 8 символов',
            "missmatch": 'Неправильные логин или пароль.'
        };
    }

    validate(credentials) {
        return this.isEmpty(credentials) && this.isEmailMissmatchPattern(credentials) && this.isPasswordMissmatchPattern(credentials);
    }

    isEmpty(credentials) {
        return credentials.login && credentials.password || this.setErrorMsg("empty");
    }

    isEmailMissmatchPattern(credentials) {
        return this.emailPattern.test(cradentials.login) || this.setErrorMsg("logError");
    }

    isPasswordMissmatchPattern(credentials) {
        return this.passwordPattern.test(credentials.password) || this.setErrorMsg("passError");
    }

    setErrorMsg(key) {
        this.errorMsg = this.errorsMsgList[key];
        return false;
    }

    getErrorMsg() {
        return this.errorMsg;
    }

    login(credentials) {
        let options = {
            headers: {
                'Content-type': 'application/json; charset=utf-8'
            },
            method: 'post',
            body: JSON.stringify(credentials)
        };
        return fetch(this.userUrl, options).then(responce => responce.json()).then(data => {
            if (data.loginStatus) {
                localStorage.setItem('credentials', JSON.stringify(credentials));
            } else {
                this.setErrorMsg("missmatch");
            }
            return data;
        });
    }

    logOut() {
        localStorage.removeItem('credentials');
    }

}

class LoginView {
    constructor() {
        this.domElements = {
            "logInBtn": document.querySelector("#log-in-form"),
            "logOutBtn": document.querySelector("#log-out-btn"),
            "login": document.querySelector("#inputEmail"),
            "password": document.querySelector("#inputPassword"),
            "navigationPanel": document.querySelector("#top-panel-navigation"),

            "showPasswordBtn": document.querySelector("#show-password"),
            "loginForm": document.querySelector("#login-form"),
            "alertWindow": document.querySelector(".alert-window"),
            "galleryWindow": document.querySelector(".gallery-window"),
            "userWindow": document.querySelector(".user-window"),
            "mainMenu": document.querySelector(".main-menu"),
            "inputPassword": document.querySelector("#otputPassword"),
            "inputEmail": document.querySelector("#otputEmail")

        };
    }

    getCradentials() {
        return {
            login: this.domElements.login.value,
            password: this.domElements.password.value
        };
    }

    hideMsg() {
        this.domElements.alertWindow.classList.add("hide");
    }

    showNavigation() {
        this.domElements.navigationPanel.classList.remove("hide");
    }

    hideLogout() {
        this.domElements.navigationPanel.classList.add("hide");
    }

}

class LoginController {
    constructor(model, view, utils) {
        this.model = model;
        this.view = view;
        this.util = utils;
        this.init();
    }

    init() {
        this.initListeners();
    }

    initListeners() {
        this.view.domElements.logInBtn.addEventListener('click', this.loginHandler.bind(this));
        this.view.domElements.logOutBtn.addEventListener('click', this.logOutHandler.bind(this));
    }

    loginHandler(e) {
        e.preventDefault();
        let credentials = this.view.getCredentials();
        if (this.model.validate(credentials)) {
            this.model.login(credentials).then(data => {
                if (data.liginSatus) {
                    this.view.hideMsg();
                    this.view.showNavigation();
                    this.utils.navigateTo("gallery");
                }
            });
        }
    }

    logoutHandler() {
        this.view.hideNavigation();
        this.model.logOut();
        this.utils.navigateTo("");
    }

}

let wraper = document.querySelector("#wrapper");
let usersLisr = "https://gist.githubusercontent.com/Igor-Garnik/7bcff581fb9f75cd21b6a5653a626ce6/raw/6439cf4ca5f8f3136be569716dbe422c4595a4b5/users-list";

let routeConfig = {
    "": () => {
        Utils.initTemplate(wrapper, "login-view");
        let model = new LoginModel(usersLisr);
        let view = new LoginView();
        let controller = new LoginController(model, view, Utils);
    },
    "gallery": () => {
        Utils.initTemplate(wrapper, "gallery-view");
        let observer = new Observer();
    },
    "profile": () => {
        Utils.initTemplate(wrapper, "profile-view");
    }
};

function activateRoute(routeName) {
    let route = routeConfig[routeName];
    route && route();
}

function updateRoute() {
    let routeName = document.location.hash.replace(/^#/, '');
    if (routeName) {
        Utils.navigateTo(routeName);
        activateRoute(routeName);
    } else {
        activateRoute(routeName);
    }
}

window.addEventListener('load', updateRoute);
window.addEventListener('hashchange', updateRoute);

}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwibG9naW4vbG9naW4ubW9kZWwuanMiLCJsb2dpbi9sb2dpbi52aWV3LmpzIiwibG9naW4vbG9naW4uY29udHJvbGxlci5qcyIsInJvdXRlci5qcyIsImFwcC5qcyJdLCJuYW1lcyI6WyJVdGlscyIsImluaXRUZW1wbGF0ZSIsIndyYXBwZXJFbCIsInRlbXBsYXRlSWQiLCJ0ZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNsb24iLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiaW5uZXJIVE1MIiwiYXBwZW5kQ2hpbGQiLCJzZXRBY3RpdmVMaW5rIiwiZWxlbSIsIm9iamVjdCIsImZvckVhY2giLCJpdGVtIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwibmF2aWdhdGVUbyIsInJvdXRlTmFtZSIsImxvY2F0aW9uIiwiaGFzaCIsImlzTG9nZ2VkSW4iLCJjcmVkZW50aWFscyIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRMb2NhbFN0b3JhZ2UiLCJ2YWx1ZSIsImtleSIsInNldEl0ZW0iLCJnZXRMb2NhbFN0b3JhZ2UiLCJMb2dpbk1vZGVsIiwidXNlclVybCIsImVtYWlsUGF0dGVybiIsInBhc3N3b3JkUGF0dGVybiIsImVycm9yTXNnIiwiZXJyb3JzTXNnTGlzdCIsImlzRW1wdHkiLCJpc0VtYWlsTWlzc21hdGNoUGF0dGVybiIsImlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuIiwibG9naW4iLCJwYXNzd29yZCIsInNldEVycm9yTXNnIiwidGVzdCIsImNyYWRlbnRpYWxzIiwib3B0aW9ucyIsInN0cmluZ2lmeSIsImZldGNoIiwidGhlbiIsInJlc3BvbmNlIiwianNvbiIsImRhdGEiLCJsb2dpblN0YXR1cyIsInJlbW92ZUl0ZW0iLCJMb2dpblZpZXciLCJkb21FbGVtZW50cyIsImFsZXJ0V2luZG93IiwibmF2aWdhdGlvblBhbmVsIiwiTG9naW5Db250cm9sbGVyIiwibW9kZWwiLCJ2aWV3IiwidXRpbHMiLCJ1dGlsIiwiaW5pdCIsImluaXRMaXN0ZW5lcnMiLCJsb2dJbkJ0biIsImFkZEV2ZW50TGlzdGVuZXIiLCJsb2dpbkhhbmRsZXIiLCJiaW5kIiwibG9nT3V0QnRuIiwibG9nT3V0SGFuZGxlciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImdldENyZWRlbnRpYWxzIiwidmFsaWRhdGUiLCJsaWdpblNhdHVzIiwiaGlkZU1zZyIsInNob3dOYXZpZ2F0aW9uIiwiaGlkZU5hdmlnYXRpb24iLCJsb2dPdXQiLCJ3cmFwZXIiLCJ1c2Vyc0xpc3IiLCJyb3V0ZUNvbmZpZyIsIndyYXBwZXIiLCJjb250cm9sbGVyIiwib2JzZXJ2ZXIiLCJPYnNlcnZlciIsImFjdGl2YXRlUm91dGUiLCJyb3V0ZSIsInVwZGF0ZVJvdXRlIiwicmVwbGFjZSIsIndpbmRvdyJdLCJtYXBwaW5ncyI6Ijs7O0FBQWUsTUFBTUEsS0FBTixDQUFZO2tCQUNUOztXQUVQQyxZQUFQLENBQW9CQyxTQUFwQixFQUErQkMsVUFBL0IsRUFBMkM7WUFDbkNDLFdBQVdDLFNBQVNDLGFBQVQsQ0FBd0IsSUFBR0gsVUFBVyxFQUF0QyxDQUFmO1lBQ0lJLE9BQU9ILFNBQVNJLE9BQVQsQ0FBaUJDLFNBQWpCLENBQTJCLElBQTNCLENBQVg7a0JBQ1VDLFNBQVYsR0FBc0IsRUFBdEI7a0JBQ1VDLFdBQVYsQ0FBc0JKLElBQXRCOzs7V0FHR0ssYUFBUCxDQUFxQkMsSUFBckIsRUFBMEJDLE1BQTFCLEVBQWtDO2VBQ3ZCQyxPQUFQLENBQWVDLFFBQVE7Z0JBQ2hCQSxRQUFRSCxJQUFYLEVBQWlCO3FCQUNSSSxTQUFMLENBQWVDLEdBQWYsQ0FBbUIsUUFBbkI7YUFESixNQUVPO3FCQUNFRCxTQUFMLENBQWVFLE1BQWYsQ0FBc0IsUUFBdEI7O1NBSlI7OztXQVNHQyxVQUFQLENBQWtCQyxTQUFsQixFQUE2QjtlQUNsQkMsUUFBUCxDQUFnQkMsSUFBaEIsR0FBc0IsTUFBTUYsU0FBNUI7OztXQUdHRyxVQUFQLEdBQW9CO1lBQ1pDLGNB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SCxFQUFjO2NBQ0pELFVBQU4sQ0FBaUJDLFNBQWpCO3NCQUNjQSxTQUFkO0tBRkosTUFHTztzQkFDV0EsU0FBZDs7OztBQ2pEUjBFLE9BQU96QixnQkFBUCxDQUF3QixNQUF4QixFQUFnQ3VCLFdBQWhDO0FBQ0FFLE9BQU96QixnQkFBUCxDQUF3QixZQUF4QixFQUFzQ3VCLFdBQXRDIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBVdGlscyB7XG4gICAgY29uc3RydWN0b3IgKCl7fVxuXG4gICAgc3RhdGljIGluaXRUZW1wbGF0ZSh3cmFwcGVyRWwsIHRlbXBsYXRlSWQpIHtcbiAgICAgICAgbGV0IHRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7dGVtcGxhdGVJZH1gKTtcbiAgICAgICAgbGV0IGNsb24gPSB0ZW1wbGF0ZS5jb250ZW50LmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgd3JhcHBlckVsLmlubmVySFRNTCA9ICcnO1xuICAgICAgICB3cmFwcGVyRWwuYXBwZW5kQ2hpbGQoY2xvbik7XG4gICAgfVxuXG4gICAgc3RhdGljIHNldEFjdGl2ZUxpbmsoZWxlbSxvYmplY3QpIHtcbiAgICAgICAgb2JqZWN0LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpZihpdGVtID09IGVsZW0pIHtcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBzdGF0aWMgbmF2aWdhdGVUbyhyb3V0ZU5hbWUpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2g9IFwiI1wiICsgcm91dGVOYW1lO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc0xvZ2dlZEluKCkge1xuICAgICAgICBsZXQgY3JlZGVudGlhbHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjcmVkZW50aWFscycpKTtcbiAgICAgICAgcmV0dXJuICEhY3JlZGVudGlhbHM7XG4gICAgfVxuXG4gICAgc3RhdGljIHNldExvY2FsU3RvcmFnZSAodmFsdWUsIGtleSkge1xuXHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKHZhbHVlLCBrZXkpO1xuXHR9XG5cblx0c3RhdGljIGdldExvY2FsU3RvcmFnZSAodmFsdWUpIHtcblx0XHRyZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0odmFsdWUpO1xuXHR9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9naW5Nb2RlbCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudXNlclVybCA9ICdodHRwczovL2dpc3QuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0lnb3ItR2FybmlrLzQzOTMxMjlkMGUxOTg1YzVmYjc2ZDNkODRhMzhhMWRiL3Jhdy9hZTU5ZjkxNTk1MGRhYTJlOWQ2NzNkYjk1MzRkMmM0MDA5Y2I5YWE1L2FkbWluLXVzZXInIFxuICAgICAgICB0aGlzLmVtYWlsUGF0dGVybiA9ICAvXihbYS16MC05Xy1dK1xcLikqW2EtejAtOV8tXStAW2EtejAtOV8tXSsoXFwuW2EtejAtOV8tXSspKlxcLlthLXpdezIsNn0kLztcbiAgICAgICAgdGhpcy5wYXNzd29yZFBhdHRlcm4gPSAvXig/PS4qXFxkKSg/PS4qW2Etel0pKD89LipbQS1aXSlbMC05YS16QS1aXXs4LDEyfSQvO1xuICAgICAgICB0aGlzLmVycm9yTXNnID0gbnVsbDtcbiAgICAgICAgdGhpcy5lcnJvcnNNc2dMaXN0ID0ge1xuICAgICAgICAgICAgXCJlbXB0eVwiICAgICA6ICfQn9C+0LbQsNC70YPQudGB0YLQsCDQt9Cw0L/QvtC70L3QuNGC0LUg0L/QvtC70Y8g0LvQvtCz0LjQvSDQuCDQv9Cw0YDQvtC70YwnLFxuICAgICAgICAgICAgXCJsb2dFcnJvclwiICA6ICfQm9C+0LPQuNC9INCy0LLQtdC00LXQvSDQvdC10LLQtdGA0L3Qvi4g0KLQvtC70YzQutC+INC70LDRgtC40L3RgdC60LjQtSDQsdGD0LrQstGLLicsXG4gICAgICAgICAgICBcInBhc3NFcnJvclwiIDogJ9Cf0LDRgNC+0LvRjCDQstCy0LXQtNC10L0g0L3QtdCy0LXRgNC90L4uINCi0L7Qu9GM0Log0LvQsNGC0LjQvdGB0LrQuNC1INCx0YPQutCy0YssINGG0LjRhNGA0YsuINCU0LvQuNC90LAg0L3QtSDQvNC10L3QtdC1IDgg0YHQuNC80LLQvtC70L7QsicsXG4gICAgICAgICAgICBcIm1pc3NtYXRjaFwiIDogJ9Cd0LXQv9GA0LDQstC40LvRjNC90YvQtSDQu9C+0LPQuNC9INC40LvQuCDQv9Cw0YDQvtC70YwuJ1xuICAgICAgICB9O1xuICAgIH1cblxuXHR2YWxpZGF0ZShjcmVkZW50aWFscykge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0VtcHR5KGNyZWRlbnRpYWxzKVxuICAgICAgICAmJiB0aGlzLmlzRW1haWxNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKVxuICAgICAgICAmJiB0aGlzLmlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKTtcbiAgICB9XG5cbiAgICBpc0VtcHR5KGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHJldHVybiAoY3JlZGVudGlhbHMubG9naW4gJiYgY3JlZGVudGlhbHMucGFzc3dvcmQpIHx8IHRoaXMuc2V0RXJyb3JNc2coXCJlbXB0eVwiKTtcbiAgICB9XG5cbiAgICBpc0VtYWlsTWlzc21hdGNoUGF0dGVybihjcmVkZW50aWFscykge1xuICAgICAgICByZXR1cm4gdGhpcy5lbWFpbFBhdHRlcm4udGVzdChjcmFkZW50aWFscy5sb2dpbikgfHwgdGhpcy5zZXRFcnJvck1zZyhcImxvZ0Vycm9yXCIpO1xuICAgIH1cblxuICAgIGlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhc3N3b3JkUGF0dGVybi50ZXN0KGNyZWRlbnRpYWxzLnBhc3N3b3JkKSB8fCB0aGlzLnNldEVycm9yTXNnKFwicGFzc0Vycm9yXCIpXG4gICAgfVxuXG4gICAgc2V0RXJyb3JNc2coa2V5KSB7XG4gICAgICAgIHRoaXMuZXJyb3JNc2cgPSB0aGlzLmVycm9yc01zZ0xpc3Rba2V5XTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGdldEVycm9yTXNnKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yTXNnO1xuICAgIH1cblxuICAgIGxvZ2luKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGNyZWRlbnRpYWxzKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZmV0Y2godGhpcy51c2VyVXJsLCBvcHRpb25zKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uY2UgPT4gcmVzcG9uY2UuanNvbigpKVxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubG9naW5TdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NyZWRlbnRpYWxzJywgSlNPTi5zdHJpbmdpZnkoY3JlZGVudGlhbHMpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVycm9yTXNnKFwibWlzc21hdGNoXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgbG9nT3V0KCkge1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY3JlZGVudGlhbHMnKTtcbiAgICB9XG5cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBMb2dpblZpZXcge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnRzID0ge1xuICAgICAgICAgICAgXCJsb2dJbkJ0blwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvZy1pbi1mb3JtXCIpLFxuICAgICAgICAgICAgXCJsb2dPdXRCdG5cIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsb2ctb3V0LWJ0blwiKSxcbiAgICAgICAgICAgIFwibG9naW5cIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbnB1dEVtYWlsXCIpLFxuICAgICAgICAgICAgXCJwYXNzd29yZFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2lucHV0UGFzc3dvcmRcIiksXG4gICAgICAgICAgICBcIm5hdmlnYXRpb25QYW5lbFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3RvcC1wYW5lbC1uYXZpZ2F0aW9uXCIpLFxuXG5cbiAgICAgICAgICAgIFwic2hvd1Bhc3N3b3JkQnRuXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc2hvdy1wYXNzd29yZFwiKSxcbiAgICAgICAgICAgIFwibG9naW5Gb3JtXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbG9naW4tZm9ybVwiKSxcbiAgICAgICAgICAgIFwiYWxlcnRXaW5kb3dcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5hbGVydC13aW5kb3dcIiksXG4gICAgICAgICAgICBcImdhbGxlcnlXaW5kb3dcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5nYWxsZXJ5LXdpbmRvd1wiKSxcbiAgICAgICAgICAgIFwidXNlcldpbmRvd1wiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnVzZXItd2luZG93XCIpLFxuICAgICAgICAgICAgXCJtYWluTWVudVwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1haW4tbWVudVwiKSxcbiAgICAgICAgICAgIFwiaW5wdXRQYXNzd29yZFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI290cHV0UGFzc3dvcmRcIiksXG4gICAgICAgICAgICBcImlucHV0RW1haWxcIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNvdHB1dEVtYWlsXCIpLFxuICAgICAgICAgICAgXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRDcmFkZW50aWFscygpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGxvZ2luOiB0aGlzLmRvbUVsZW1lbnRzLmxvZ2luLnZhbHVlLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHRoaXMuZG9tRWxlbWVudHMucGFzc3dvcmQudmFsdWVcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhpZGVNc2coKSB7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudHMuYWxlcnRXaW5kb3cuY2xhc3NMaXN0LmFkZChcImhpZGVcIik7XG4gICAgfVxuXG4gICAgc2hvd05hdmlnYXRpb24oKSB7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudHMubmF2aWdhdGlvblBhbmVsLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xuICAgIH1cblxuICAgIGhpZGVMb2dvdXQoKSB7XG4gICAgICAgIHRoaXMuZG9tRWxlbWVudHMubmF2aWdhdGlvblBhbmVsLmNsYXNzTGlzdC5hZGQoXCJoaWRlXCIpO1xuICAgIH1cbiAgIFxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIExvZ2luQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IobW9kZWwsIHZpZXcsIHV0aWxzKSB7XG4gICAgICAgIHRoaXMubW9kZWwgPSBtb2RlbDtcbiAgICAgICAgdGhpcy52aWV3ID0gdmlldztcbiAgICAgICAgdGhpcy51dGlsID0gdXRpbHM7XG4gICAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMuaW5pdExpc3RlbmVycygpO1xuICAgIH1cblxuICAgIGluaXRMaXN0ZW5lcnMoKSB7XG4gICAgICAgIHRoaXMudmlldy5kb21FbGVtZW50cy5sb2dJbkJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMubG9naW5IYW5kbGVyLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnZpZXcuZG9tRWxlbWVudHMubG9nT3V0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5sb2dPdXRIYW5kbGVyLmJpbmQodGhpcykpXG4gICAgfVxuXG4gICAgbG9naW5IYW5kbGVyKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBsZXQgY3JlZGVudGlhbHMgPSB0aGlzLnZpZXcuZ2V0Q3JlZGVudGlhbHMoKTtcbiAgICAgICAgaWYodGhpcy5tb2RlbC52YWxpZGF0ZShjcmVkZW50aWFscykpIHtcbiAgICAgICAgICAgIHRoaXMubW9kZWwubG9naW4oY3JlZGVudGlhbHMpLnRoZW4oXG4gICAgICAgICAgICAgICAgZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGRhdGEubGlnaW5TYXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3LmhpZGVNc2coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlldy5zaG93TmF2aWdhdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51dGlscy5uYXZpZ2F0ZVRvKFwiZ2FsbGVyeVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGxvZ291dEhhbmRsZXIoKSB7XG4gICAgICAgIHRoaXMudmlldy5oaWRlTmF2aWdhdGlvbigpO1xuICAgICAgICB0aGlzLm1vZGVsLmxvZ091dCgpO1xuICAgICAgICB0aGlzLnV0aWxzLm5hdmlnYXRlVG8oXCJcIik7XG4gICAgfVxuXG59IiwiaW1wb3J0IHV0aWxzIGZyb20gJy4vdXRpbHMuanMnO1xuXG5pbXBvcnQgR2FsbGVyeU1vZGVsIGZyb20gJy4vZ2FsbGVyeS9nYWxsZXJ5Lm1vZGVsLmpzJztcbmltcG9ydCBHYWxsZXJ5VmlldyBmcm9tICcuL2dhbGxlcnkvZ2FsbGVyeS52aWV3LmpzJztcbmltcG9ydCBHYWxsZXJ5Q29udHJvbGxlciBmcm9tICcuL2dhbGxlcnkvZ2FsbGVyeS5jb250cm9sbGVyLmpzJztcblxuaW1wb3J0IExvZ2luTW9kZWwgZnJvbSAnLi9sb2dpbi9sb2dpbi5tb2RlbC5qcyc7XG5pbXBvcnQgTG9naW5WaWV3IGZyb20gJy4vbG9naW4vbG9naW4udmlldy5qcyc7XG5pbXBvcnQgTG9naW5Db250cm9sbGVyIGZyb20gJy4vbG9naW4vbG9naW4uY29udHJvbGxlci5qcyc7XG5cbmltcG9ydCBQcm9maWxlTW9kZWwgZnJvbSAnLi9wcm9maWxlL3Byb2ZpbGUubW9kZWwuanMnO1xuaW1wb3J0IFByb2ZpbGVWaWV3IGZyb20gJy4vcHJvZmlsZS9wcm9maWxlLnZpZXcuanMnO1xuaW1wb3J0IFByb2ZpbGVDb250cm9sbGVyIGZyb20gJy4vcHJvZmlsZS9wcm9maWxlLmNvbnRyb2xsZXIuanMnXG5cbmxldCB3cmFwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dyYXBwZXJcIik7XG5sZXQgY2Fyc0xpc3QgPSBcImh0dHBzOi8vZ2lzdC5naXRodWJ1c2VyY29udGVudC5jb20vSWdvci1HYXJuaWsvMDM5YjQxMjdiNGZlYTllZGRmMWI4NzYwYTFjYmMzZDQvcmF3L2VjNTIzNTY3ZWFhMWVhZjBmYTU3Yzk4ZGNhMWY4NTExYjAxYmMxZGIvY2Fycy1saXN0XCI7XG5sZXQgdXNlcnNMaXNyID0gXCJodHRwczovL2dpc3QuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0lnb3ItR2FybmlrLzdiY2ZmNTgxZmI5Zjc1Y2QyMWI2YTU2NTNhNjI2Y2U2L3Jhdy82NDM5Y2Y0Y2E1ZjhmMzEzNmJlNTY5NzE2ZGJlNDIyYzQ1OTVhNGI1L3VzZXJzLWxpc3RcIjtcblxubGV0IHJvdXRlQ29uZmlnID0ge1xuICAgIFwiXCIgOiAoKSA9PiB7XG4gICAgICAgIHV0aWxzLmluaXRUZW1wbGF0ZSh3cmFwcGVyLCBcImxvZ2luLXZpZXdcIik7XG4gICAgICAgIGxldCBtb2RlbCA9IG5ldyBMb2dpbk1vZGVsKHVzZXJzTGlzcik7XG4gICAgICAgIGxldCB2aWV3ID0gbmV3IExvZ2luVmlldztcbiAgICAgICAgbGV0IGNvbnRyb2xsZXIgPSBuZXcgTG9naW5Db250cm9sbGVyKG1vZGVsLCB2aWV3LCB1dGlscyk7XG4gICAgfSwgXG4gICAgXCJnYWxsZXJ5XCIgOiAoKSA9PiB7XG4gICAgICAgIHV0aWxzLmluaXRUZW1wbGF0ZSh3cmFwcGVyLCBcImdhbGxlcnktdmlld1wiKTtcbiAgICAgICAgbGV0IG1vZGVsID0gbmV3IEdhbGxlcnlNb2RlbChjYXJzTGlzdCk7XG4gICAgICAgIGxldCB2aWV3ID0gbmV3IEdhbGxlcnlWaWV3O1xuICAgICAgICBsZXQgb2JzZXJ2ZXIgPSBuZXcgT2JzZXJ2ZXI7XG4gICAgICAgIG5ldyBHYWxsZXJ5Q29udHJvbGxlcihtb2RlbCwgdmlldywgb2JzZXJ2ZXIsIHV0aWxzKTtcbiAgICB9LFxuICAgIFwicHJvZmlsZVwiIDogKCkgPT4ge1xuICAgICAgICB1dGlscy5pbml0VGVtcGxhdGUod3JhcHBlciwgXCJwcm9maWxlLXZpZXdcIik7XG4gICAgICAgIGxldCBtb2RlbCA9IG5ldyBQcm9maWxlTW9kZWwodXNlcnNMaXN0KTtcbiAgICAgICAgbGV0IHZpZXcgPSBuZXcgUHJvZmlsZVZpZXc7XG4gICAgICAgIG5ldyBQcm9maWxlQ29udHJvbGxlcihtb2RlbCwgdmlldywgdXRpbHMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gYWN0aXZhdGVSb3V0ZShyb3V0ZU5hbWUpe1xuICAgIGxldCByb3V0ZSA9IHJvdXRlQ29uZmlnW3JvdXRlTmFtZV07XG4gICAgcm91dGUgJiYgcm91dGUoKTsgICAgXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSb3V0ZSgpIHtcbiAgICBsZXQgcm91dGVOYW1lID0gZG9jdW1lbnQubG9jYXRpb24uaGFzaC5yZXBsYWNlKC9eIy8sICcnKTtcbiAgICBpZihyb3V0ZU5hbWUpIHtcbiAgICAgICAgdXRpbHMubmF2aWdhdGVUbyhyb3V0ZU5hbWUpOyBcbiAgICAgICAgYWN0aXZhdGVSb3V0ZShyb3V0ZU5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGFjdGl2YXRlUm91dGUocm91dGVOYW1lKTtcbiAgICB9XG59IiwiaW1wb3J0IHsgdXBkYXRlUm91dGUgfSBmcm9tICcuL3JvdXRlci5qcydcblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCB1cGRhdGVSb3V0ZSk7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignaGFzaGNoYW5nZScsIHVwZGF0ZVJvdXRlKTsiXX0=
