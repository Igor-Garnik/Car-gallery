(function () {
'use strict';

class Utils {
    constructor() {}

    static initTemplate(wrapperEl, templateId) {
        let template = document.querySelector(`#${templateId}`);
        let clon = template.content.cloneNode(true);
        wrapperEl.innerHTML = '';
        wrapperEl.appendChild(clon);
    }

    static setActiveLink(elem, object) {
        object.forEach(item => {
            if (item == elem) {
                item.classList.add("active");
            } else {
                item.classList.remove("active");
            }
        });
    }

    static navigateTo(routeName) {
        window.location.hash = "#" + routeName;
    }

    static isLoggedIn() {
        let credentials = JSON.parse(localStorage.getItem('credentials'));
        return !!credentials;
    }

    static setLocalStorage(value, key) {
        localStorage.setItem(value, key);
    }

    static getLocalStorage(value) {
        return localStorage.getItem(value);
    }
}

class LoginModel {
    constructor() {
        this.userUrl = 'https://gist.githubusercontent.com/Igor-Garnik/4393129d0e1985c5fb76d3d84a38a1db/raw/ae59f915950daa2e9d673db9534d2c4009cb9aa5/admin-user';
        this.emailPattern = /^([a-z0-9_-]+\.)*[a-z0-9_-]+@[a-z0-9_-]+(\.[a-z0-9_-]+)*\.[a-z]{2,6}$/;
        this.passwordPattern = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,12}$/;
        this.errorMsg = null;
        this.errorsMsgList = {
            "empty": 'Пожалуйста заполните поля логин и пароль',
            "logError": 'Логин введен неверно. Только латинские буквы.',
            "passError": 'Пароль введен неверно. Тольк латинские буквы, цифры. Длина не менее 8 символов',
            "missmatch": 'Неправильные логин или пароль.'
        };
    }

    validate(credentials) {
        return this.isEmpty(credentials) && this.isEmailMissmatchPattern(credentials) && this.isPasswordMissmatchPattern(credentials);
    }

    isEmpty(credentials) {
        return credentials.login && credentials.password || this.setErrorMsg("empty");
    }

    isEmailMissmatchPattern(credentials) {
        return this.emailPattern.test(cradentials.login) || this.setErrorMsg("logError");
    }

    isPasswordMissmatchPattern(credentials) {
        return this.passwordPattern.test(credentials.password) || this.setErrorMsg("passError");
    }

    setErrorMsg(key) {
        this.errorMsg = this.errorsMsgList[key];
        return false;
    }

    getErrorMsg() {
        return this.errorMsg;
    }

    login(credentials) {
        let options = {
            headers: {
                'Content-type': 'application/json; charset=utf-8'
            },
            method: 'post',
            body: JSON.stringify(credentials)
        };
        return fetch(this.userUrl, options).then(responce => responce.json()).then(data => {
            if (data.loginStatus) {
                localStorage.setItem('credentials', JSON.stringify(credentials));
            } else {
                this.setErrorMsg("missmatch");
            }
            return data;
        });
    }

    logOut() {
        localStorage.removeItem('credentials');
    }

}

class LoginView {
    constructor() {
        this.domElements = {
            "logInBtn": document.querySelector("#log-in-btn"),
            "logOutBtn": document.querySelector("#log-out-btn"),
            "login": document.querySelector("#inputEmail"),
            "password": document.querySelector("#inputPassword"),
            "navigationPanel": document.querySelector("#top-panel-navigation"),

            "showPasswordBtn": document.querySelector("#show-password"),
            "loginForm": document.querySelector("#login-form"),
            "alertWindow": document.querySelector(".alert-window"),
            "galleryWindow": document.querySelector(".gallery-window"),
            "userWindow": document.querySelector(".user-window"),
            "mainMenu": document.querySelector(".main-menu"),
            "inputPassword": document.querySelector("#otputPassword"),
            "inputEmail": document.querySelector("#otputEmail")

        };
    }

    getCradentials() {
        return {
            login: this.domElements.login.value,
            password: this.domElements.password.value
        };
    }

    hideMsg() {
        this.domElements.alertWindow.classList.add("hide");
    }

    showNavigation() {
        this.domElements.navigationPanel.classList.remove("hide");
    }

    hideLogout() {
        this.domElements.navigationPanel.classList.add("hide");
    }

}

class LoginController {
    constructor(model, view, utils) {
        this.model = model;
        this.view = view;
        this.util = utils;
        this.init();
        this.tect = null;
    }

    init() {
        this.initListeners();
    }

    initListeners() {
        this.view.domElements.logInBtn.addEventListener('click', this.loginHandler.bind(this));
        this.view.domElements.logOutBtn.addEventListener('click', this.logOutHandler.bind(this));
    }

    loginHandler(e) {
        e.preventDefault();
        let credentials = this.view.getCredentials();
        if (this.model.validate(credentials)) {
            this.model.login(credentials).then(data => {
                if (data.liginSatus) {
                    this.view.hideMsg();
                    this.view.showNavigation();
                    this.utils.navigateTo("gallery");
                }
            });
        }
    }

    logOutHandler() {
        this.view.hideNavigation();
        this.model.logOut();
        this.utils.navigateTo("");
    }

}

let wraper = document.querySelector("#wrapper");
let usersLisr = "https://gist.githubusercontent.com/Igor-Garnik/7bcff581fb9f75cd21b6a5653a626ce6/raw/6439cf4ca5f8f3136be569716dbe422c4595a4b5/users-list";

let routeConfig = {
    "": () => {
        Utils.initTemplate(wrapper, "login-view");
        let model = new LoginModel(usersLisr);
        let view = new LoginView();
        let controller = new LoginController(model, view, Utils);
    },
    "gallery": () => {
        Utils.initTemplate(wrapper, "gallery-view");
        let observer = new Observer();
    },
    "profile": () => {
        Utils.initTemplate(wrapper, "profile-view");
    }
};

function activateRoute(routeName) {
    let route = routeConfig[routeName];
    route && route();
}

function updateRoute() {
    let routeName = document.location.hash.replace(/^#/, '');
    if (routeName) {
        Utils.navigateTo(routeName);
        activateRoute(routeName);
    } else {
        activateRoute(routeName);
    }
}

window.addEventListener('load', updateRoute);
window.addEventListener('hashchange', updateRoute);

}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwibG9naW4vbG9naW4ubW9kZWwuanMiLCJsb2dpbi9sb2dpbi52aWV3LmpzIiwibG9naW4vbG9naW4uY29udHJvbGxlci5qcyIsInJvdXRlci5qcyIsImFwcC5qcyJdLCJuYW1lcyI6WyJVdGlscyIsImluaXRUZW1wbGF0ZSIsIndyYXBwZXJFbCIsInRlbXBsYXRlSWQiLCJ0ZW1wbGF0ZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNsb24iLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiaW5uZXJIVE1MIiwiYXBwZW5kQ2hpbGQiLCJzZXRBY3RpdmVMaW5rIiwiZWxlbSIsIm9iamVjdCIsImZvckVhY2giLCJpdGVtIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwibmF2aWdhdGVUbyIsInJvdXRlTmFtZSIsImxvY2F0aW9uIiwiaGFzaCIsImlzTG9nZ2VkSW4iLCJjcmVkZW50aWFscyIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRMb2NhbFN0b3JhZ2UiLCJ2YWx1ZSIsImtleSIsInNldEl0ZW0iLCJnZXRMb2NhbFN0b3JhZ2UiLCJMb2dpbk1vZGVsIiwidXNlclVybCIsImVtYWlsUGF0dGVybiIsInBhc3N3b3JkUGF0dGVybiIsImVycm9yTXNnIiwiZXJyb3JzTXNnTGlzdCIsImlzRW1wdHkiLCJpc0VtYWlsTWlzc21hdGNoUGF0dGVybiIsImlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuIiwibG9naW4iLCJwYXNzd29yZCIsInNldEVycm9yTXNnIiwidGVzdCIsImNyYWRlbnRpYWxzIiwib3B0aW9ucyIsInN0cmluZ2lmeSIsImZldGNoIiwidGhlbiIsInJlc3BvbmNlIiwianNvbiIsImRhdGEiLCJsb2dpblN0YXR1cyIsInJlbW92ZUl0ZW0iLCJMb2dpblZpZXciLCJkb21FbGVtZW50cyIsImFsZXJ0V2luZG93IiwibmF2aWdhdGlvblBhbmVsIiwiTG9naW5Db250cm9sbGVyIiwibW9kZWwiLCJ2aWV3IiwidXRpbHMiLCJ1dGlsIiwiaW5pdCIsInRlY3QiLCJpbml0TGlzdGVuZXJzIiwibG9nSW5CdG4iLCJhZGRFdmVudExpc3RlbmVyIiwibG9naW5IYW5kbGVyIiwiYmluZCIsImxvZ091dEJ0biIsImxvZ091dEhhbmRsZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJnZXRDcmVkZW50aWFscyIsInZhbGlkYXRlIiwibGlnaW5TYXR1cyIsImhpZGVNc2ciLCJzaG93TmF2aWdhdGlvbiIsImhpZGVOYXZpZ2F0aW9uIiwibG9nT3V0Iiwid3JhcGVyIiwidXNlcnNMaXNyIiwicm91dGVDb25maWciLCJ3cmFwcGVyIiwiY29udHJvbGxlciIsIm9ic2VydmVyIiwiT2JzZXJ2ZXIiLCJhY3RpdmF0ZVJvdXRlIiwicm91dGUiLCJ1cGRhdGVSb3V0ZSIsInJlcGxhY2UiLCJ3aW5kb3ciXSwibWFwcGluZ3MiOiI7OztBQUFlLE1BQU1BLEtBQU4sQ0FBWTtrQkFDVDs7V0FFUEMsWUFBUCxDQUFvQkMsU0FBcEIsRUFBK0JDLFVBQS9CLEVBQTJDO1lBQ25DQyxXQUFXQyxTQUFTQyxhQUFULENBQXdCLElBQUdILFVBQVcsRUFBdEMsQ0FBZjtZQUNJSSxPQUFPSCxTQUFTSSxPQUFULENBQWlCQyxTQUFqQixDQUEyQixJQUEzQixDQUFYO2tCQUNVQyxTQUFWLEdBQXNCLEVBQXRCO2tCQUNVQyxXQUFWLENBQXNCSixJQUF0Qjs7O1dBR0dLLGFBQVAsQ0FBcUJDLElBQXJCLEVBQTBCQyxNQUExQixFQUFrQztlQUN2QkMsT0FBUCxDQUFlQyxRQUFRO2dCQUNoQkEsUUFBUUgsSUFBWCxFQUFpQjtxQkFDUkksU0FBTCxDQUFlQyxHQUFmLENBQW1CLFFBQW5CO2FBREosTUFFTztxQkFDRUQsU0FBTCxDQUFlRSxNQUFmLENBQXNCLFFBQXRCOztTQUpSOzs7V0FTR0MsVUFBUCxDQUFrQkMsU0FBbEIsRUFBNkI7ZUFDbEJDLFFBQVAsQ0FBZ0JDLElBQWhCLEdBQXNCLE1BQU1GLFNBQTVCOzs7V0FHR0csVUFBUCxHQUFvQjtZ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QixFQUFxQyxFQUFyQyxDQUFoQjtRQUNHMUUsU0FBSCxFQUFjO2NBQ0pELFVBQU4sQ0FBaUJDLFNBQWpCO3NCQUNjQSxTQUFkO0tBRkosTUFHTztzQkFDV0EsU0FBZDs7OztBQ2pEUjJFLE9BQU96QixnQkFBUCxDQUF3QixNQUF4QixFQUFnQ3VCLFdBQWhDO0FBQ0FFLE9BQU96QixnQkFBUCxDQUF3QixZQUF4QixFQUFzQ3VCLFdBQXRDIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBVdGlscyB7XG4gICAgY29uc3RydWN0b3IgKCl7fVxuXG4gICAgc3RhdGljIGluaXRUZW1wbGF0ZSh3cmFwcGVyRWwsIHRlbXBsYXRlSWQpIHtcbiAgICAgICAgbGV0IHRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7dGVtcGxhdGVJZH1gKTtcbiAgICAgICAgbGV0IGNsb24gPSB0ZW1wbGF0ZS5jb250ZW50LmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgd3JhcHBlckVsLmlubmVySFRNTCA9ICcnO1xuICAgICAgICB3cmFwcGVyRWwuYXBwZW5kQ2hpbGQoY2xvbik7XG4gICAgfVxuXG4gICAgc3RhdGljIHNldEFjdGl2ZUxpbmsoZWxlbSxvYmplY3QpIHtcbiAgICAgICAgb2JqZWN0LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICBpZihpdGVtID09IGVsZW0pIHtcbiAgICAgICAgICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBzdGF0aWMgbmF2aWdhdGVUbyhyb3V0ZU5hbWUpIHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2g9IFwiI1wiICsgcm91dGVOYW1lO1xuICAgIH1cblxuICAgIHN0YXRpYyBpc0xvZ2dlZEluKCkge1xuICAgICAgICBsZXQgY3JlZGVudGlhbHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjcmVkZW50aWFscycpKTtcbiAgICAgICAgcmV0dXJuICEhY3JlZGVudGlhbHM7XG4gICAgfVxuXG4gICAgc3RhdGljIHNldExvY2FsU3RvcmFnZSAodmFsdWUsIGtleSkge1xuXHRcdGxvY2FsU3RvcmFnZS5zZXRJdGVtKHZhbHVlLCBrZXkpO1xuXHR9XG5cblx0c3RhdGljIGdldExvY2FsU3RvcmFnZSAodmFsdWUpIHtcblx0XHRyZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0odmFsdWUpO1xuXHR9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9naW5Nb2RlbCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMudXNlclVybCA9ICdodHRwczovL2dpc3QuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0lnb3ItR2FybmlrLzQzOTMxMjlkMGUxOTg1YzVmYjc2ZDNkODRhMzhhMWRiL3Jhdy9hZTU5ZjkxNTk1MGRhYTJlOWQ2NzNkYjk1MzRkMmM0MDA5Y2I5YWE1L2FkbWluLXVzZXInIFxuICAgICAgICB0aGlzLmVtYWlsUGF0dGVybiA9ICAvXihbYS16MC05Xy1dK1xcLikqW2EtejAtOV8tXStAW2EtejAtOV8tXSsoXFwuW2EtejAtOV8tXSspKlxcLlthLXpdezIsNn0kLztcbiAgICAgICAgdGhpcy5wYXNzd29yZFBhdHRlcm4gPSAvXig/PS4qXFxkKSg/PS4qW2Etel0pKD89LipbQS1aXSlbMC05YS16QS1aXXs4LDEyfSQvO1xuICAgICAgICB0aGlzLmVycm9yTXNnID0gbnVsbDtcbiAgICAgICAgdGhpcy5lcnJvcnNNc2dMaXN0ID0ge1xuICAgICAgICAgICAgXCJlbXB0eVwiICAgICA6ICfQn9C+0LbQsNC70YPQudGB0YLQsCDQt9Cw0L/QvtC70L3QuNGC0LUg0L/QvtC70Y8g0LvQvtCz0LjQvSDQuCDQv9Cw0YDQvtC70YwnLFxuICAgICAgICAgICAgXCJsb2dFcnJvclwiICA6ICfQm9C+0LPQuNC9INCy0LLQtdC00LXQvSDQvdC10LLQtdGA0L3Qvi4g0KLQvtC70YzQutC+INC70LDRgtC40L3RgdC60LjQtSDQsdGD0LrQstGLLicsXG4gICAgICAgICAgICBcInBhc3NFcnJvclwiIDogJ9Cf0LDRgNC+0LvRjCDQstCy0LXQtNC10L0g0L3QtdCy0LXRgNC90L4uINCi0L7Qu9GM0Log0LvQsNGC0LjQvdGB0LrQuNC1INCx0YPQutCy0YssINGG0LjRhNGA0YsuINCU0LvQuNC90LAg0L3QtSDQvNC10L3QtdC1IDgg0YHQuNC80LLQvtC70L7QsicsXG4gICAgICAgICAgICBcIm1pc3NtYXRjaFwiIDogJ9Cd0LXQv9GA0LDQstC40LvRjNC90YvQtSDQu9C+0LPQuNC9INC40LvQuCDQv9Cw0YDQvtC70YwuJ1xuICAgICAgICB9O1xuICAgIH1cblxuXHR2YWxpZGF0ZShjcmVkZW50aWFscykge1xuICAgICAgICByZXR1cm4gdGhpcy5pc0VtcHR5KGNyZWRlbnRpYWxzKVxuICAgICAgICAmJiB0aGlzLmlzRW1haWxNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKVxuICAgICAgICAmJiB0aGlzLmlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKTtcbiAgICB9XG5cbiAgICBpc0VtcHR5KGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHJldHVybiAoY3JlZGVudGlhbHMubG9naW4gJiYgY3JlZGVudGlhbHMucGFzc3dvcmQpIHx8IHRoaXMuc2V0RXJyb3JNc2coXCJlbXB0eVwiKTtcbiAgICB9XG5cbiAgICBpc0VtYWlsTWlzc21hdGNoUGF0dGVybihjcmVkZW50aWFscykge1xuICAgICAgICByZXR1cm4gdGhpcy5lbWFpbFBhdHRlcm4udGVzdChjcmFkZW50aWFscy5sb2dpbikgfHwgdGhpcy5zZXRFcnJvck1zZyhcImxvZ0Vycm9yXCIpO1xuICAgIH1cblxuICAgIGlzUGFzc3dvcmRNaXNzbWF0Y2hQYXR0ZXJuKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhc3N3b3JkUGF0dGVybi50ZXN0KGNyZWRlbnRpYWxzLnBhc3N3b3JkKSB8fCB0aGlzLnNldEVycm9yTXNnKFwicGFzc0Vycm9yXCIpXG4gICAgfVxuXG4gICAgc2V0RXJyb3JNc2coa2V5KSB7XG4gICAgICAgIHRoaXMuZXJyb3JNc2cgPSB0aGlzLmVycm9yc01zZ0xpc3Rba2V5XTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGdldEVycm9yTXNnKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yTXNnO1xuICAgIH1cblxuICAgIGxvZ2luKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGxldCBvcHRpb25zID0ge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGNyZWRlbnRpYWxzKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZmV0Y2godGhpcy51c2VyVXJsLCBvcHRpb25zKVxuICAgICAgICAgICAgLnRoZW4ocmVzcG9uY2UgPT4gcmVzcG9uY2UuanNvbigpKVxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEubG9naW5TdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NyZWRlbnRpYWxzJywgSlNPTi5zdHJpbmdpZnkoY3JlZGVudGlhbHMpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEVycm9yTXNnKFwibWlzc21hdGNoXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgbG9nT3V0KCkge1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnY3JlZGVudGlhbHMnKTtcbiAgICB9XG5cbn0iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBMb2dpblZpZXcge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmRvbUVsZW1lbnRzID0ge1xuICAgICAgICAgICAgXCJsb2dJbkJ0blwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvZy1pbi1idG5cIiksXG4gICAgICAgICAgICBcImxvZ091dEJ0blwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xvZy1vdXQtYnRuXCIpLFxuICAgICAgICAgICAgXCJsb2dpblwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2lucHV0RW1haWxcIiksXG4gICAgICAgICAgICBcInBhc3N3b3JkXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW5wdXRQYXNzd29yZFwiKSxcbiAgICAgICAgICAgIFwibmF2aWdhdGlvblBhbmVsXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdG9wLXBhbmVsLW5hdmlnYXRpb25cIiksXG5cblxuICAgICAgICAgICAgXCJzaG93UGFzc3dvcmRCdG5cIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzaG93LXBhc3N3b3JkXCIpLFxuICAgICAgICAgICAgXCJsb2dpbkZvcm1cIjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNsb2dpbi1mb3JtXCIpLFxuICAgICAgICAgICAgXCJhbGVydFdpbmRvd1wiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmFsZXJ0LXdpbmRvd1wiKSxcbiAgICAgICAgICAgIFwiZ2FsbGVyeVdpbmRvd1wiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnktd2luZG93XCIpLFxuICAgICAgICAgICAgXCJ1c2VyV2luZG93XCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudXNlci13aW5kb3dcIiksXG4gICAgICAgICAgICBcIm1haW5NZW51XCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWFpbi1tZW51XCIpLFxuICAgICAgICAgICAgXCJpbnB1dFBhc3N3b3JkXCI6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjb3RwdXRQYXNzd29yZFwiKSxcbiAgICAgICAgICAgIFwiaW5wdXRFbWFpbFwiOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI290cHV0RW1haWxcIiksXG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldENyYWRlbnRpYWxzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbG9naW46IHRoaXMuZG9tRWxlbWVudHMubG9naW4udmFsdWUsXG4gICAgICAgICAgICBwYXNzd29yZDogdGhpcy5kb21FbGVtZW50cy5wYXNzd29yZC52YWx1ZVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgaGlkZU1zZygpIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50cy5hbGVydFdpbmRvdy5jbGFzc0xpc3QuYWRkKFwiaGlkZVwiKTtcbiAgICB9XG5cbiAgICBzaG93TmF2aWdhdGlvbigpIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50cy5uYXZpZ2F0aW9uUGFuZWwuY2xhc3NMaXN0LnJlbW92ZShcImhpZGVcIik7XG4gICAgfVxuXG4gICAgaGlkZUxvZ291dCgpIHtcbiAgICAgICAgdGhpcy5kb21FbGVtZW50cy5uYXZpZ2F0aW9uUGFuZWwuY2xhc3NMaXN0LmFkZChcImhpZGVcIik7XG4gICAgfVxuICAgXG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9naW5Db250cm9sbGVyIHtcbiAgICBjb25zdHJ1Y3Rvcihtb2RlbCwgdmlldywgdXRpbHMpIHtcbiAgICAgICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgICAgICB0aGlzLnZpZXcgPSB2aWV3O1xuICAgICAgICB0aGlzLnV0aWwgPSB1dGlscztcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgICAgIHRoaXMudGVjdCA9IG51bGw7XG5cbiAgICB9XG5cbiAgICBpbml0KCkge1xuICAgICAgICB0aGlzLmluaXRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBpbml0TGlzdGVuZXJzKCkge1xuICAgICAgICB0aGlzLnZpZXcuZG9tRWxlbWVudHMubG9nSW5CdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmxvZ2luSGFuZGxlci5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy52aWV3LmRvbUVsZW1lbnRzLmxvZ091dEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMubG9nT3V0SGFuZGxlci5iaW5kKHRoaXMpKVxuICAgIH1cblxuICAgIGxvZ2luSGFuZGxlcihlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbGV0IGNyZWRlbnRpYWxzID0gdGhpcy52aWV3LmdldENyZWRlbnRpYWxzKCk7XG4gICAgICAgIGlmKHRoaXMubW9kZWwudmFsaWRhdGUoY3JlZGVudGlhbHMpKSB7XG4gICAgICAgICAgICB0aGlzLm1vZGVsLmxvZ2luKGNyZWRlbnRpYWxzKS50aGVuKFxuICAgICAgICAgICAgICAgIGRhdGEgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmxpZ2luU2F0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlldy5oaWRlTXNnKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXcuc2hvd05hdmlnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXRpbHMubmF2aWdhdGVUbyhcImdhbGxlcnlcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsb2dPdXRIYW5kbGVyKCkge1xuICAgICAgICB0aGlzLnZpZXcuaGlkZU5hdmlnYXRpb24oKTtcbiAgICAgICAgdGhpcy5tb2RlbC5sb2dPdXQoKTtcbiAgICAgICAgdGhpcy51dGlscy5uYXZpZ2F0ZVRvKFwiXCIpO1xuICAgIH1cblxufSIsImltcG9ydCB1dGlscyBmcm9tICcuL3V0aWxzLmpzJztcblxuaW1wb3J0IEdhbGxlcnlNb2RlbCBmcm9tICcuL2dhbGxlcnkvZ2FsbGVyeS5tb2RlbC5qcyc7XG5pbXBvcnQgR2FsbGVyeVZpZXcgZnJvbSAnLi9nYWxsZXJ5L2dhbGxlcnkudmlldy5qcyc7XG5pbXBvcnQgR2FsbGVyeUNvbnRyb2xsZXIgZnJvbSAnLi9nYWxsZXJ5L2dhbGxlcnkuY29udHJvbGxlci5qcyc7XG5cbmltcG9ydCBMb2dpbk1vZGVsIGZyb20gJy4vbG9naW4vbG9naW4ubW9kZWwuanMnO1xuaW1wb3J0IExvZ2luVmlldyBmcm9tICcuL2xvZ2luL2xvZ2luLnZpZXcuanMnO1xuaW1wb3J0IExvZ2luQ29udHJvbGxlciBmcm9tICcuL2xvZ2luL2xvZ2luLmNvbnRyb2xsZXIuanMnO1xuXG5pbXBvcnQgUHJvZmlsZU1vZGVsIGZyb20gJy4vcHJvZmlsZS9wcm9maWxlLm1vZGVsLmpzJztcbmltcG9ydCBQcm9maWxlVmlldyBmcm9tICcuL3Byb2ZpbGUvcHJvZmlsZS52aWV3LmpzJztcbmltcG9ydCBQcm9maWxlQ29udHJvbGxlciBmcm9tICcuL3Byb2ZpbGUvcHJvZmlsZS5jb250cm9sbGVyLmpzJ1xuXG5sZXQgd3JhcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3cmFwcGVyXCIpO1xubGV0IGNhcnNMaXN0ID0gXCJodHRwczovL2dpc3QuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0lnb3ItR2FybmlrLzAzOWI0MTI3YjRmZWE5ZWRkZjFiODc2MGExY2JjM2Q0L3Jhdy9lYzUyMzU2N2VhYTFlYWYwZmE1N2M5OGRjYTFmODUxMWIwMWJjMWRiL2NhcnMtbGlzdFwiO1xubGV0IHVzZXJzTGlzciA9IFwiaHR0cHM6Ly9naXN0LmdpdGh1YnVzZXJjb250ZW50LmNvbS9JZ29yLUdhcm5pay83YmNmZjU4MWZiOWY3NWNkMjFiNmE1NjUzYTYyNmNlNi9yYXcvNjQzOWNmNGNhNWY4ZjMxMzZiZTU2OTcxNmRiZTQyMmM0NTk1YTRiNS91c2Vycy1saXN0XCI7XG5cbmxldCByb3V0ZUNvbmZpZyA9IHtcbiAgICBcIlwiIDogKCkgPT4ge1xuICAgICAgICB1dGlscy5pbml0VGVtcGxhdGUod3JhcHBlciwgXCJsb2dpbi12aWV3XCIpO1xuICAgICAgICBsZXQgbW9kZWwgPSBuZXcgTG9naW5Nb2RlbCh1c2Vyc0xpc3IpO1xuICAgICAgICBsZXQgdmlldyA9IG5ldyBMb2dpblZpZXc7XG4gICAgICAgIGxldCBjb250cm9sbGVyID0gbmV3IExvZ2luQ29udHJvbGxlcihtb2RlbCwgdmlldywgdXRpbHMpO1xuICAgIH0sIFxuICAgIFwiZ2FsbGVyeVwiIDogKCkgPT4ge1xuICAgICAgICB1dGlscy5pbml0VGVtcGxhdGUod3JhcHBlciwgXCJnYWxsZXJ5LXZpZXdcIik7XG4gICAgICAgIGxldCBtb2RlbCA9IG5ldyBHYWxsZXJ5TW9kZWwoY2Fyc0xpc3QpO1xuICAgICAgICBsZXQgdmlldyA9IG5ldyBHYWxsZXJ5VmlldztcbiAgICAgICAgbGV0IG9ic2VydmVyID0gbmV3IE9ic2VydmVyO1xuICAgICAgICBuZXcgR2FsbGVyeUNvbnRyb2xsZXIobW9kZWwsIHZpZXcsIG9ic2VydmVyLCB1dGlscyk7XG4gICAgfSxcbiAgICBcInByb2ZpbGVcIiA6ICgpID0+IHtcbiAgICAgICAgdXRpbHMuaW5pdFRlbXBsYXRlKHdyYXBwZXIsIFwicHJvZmlsZS12aWV3XCIpO1xuICAgICAgICBsZXQgbW9kZWwgPSBuZXcgUHJvZmlsZU1vZGVsKHVzZXJzTGlzdCk7XG4gICAgICAgIGxldCB2aWV3ID0gbmV3IFByb2ZpbGVWaWV3O1xuICAgICAgICBuZXcgUHJvZmlsZUNvbnRyb2xsZXIobW9kZWwsIHZpZXcsIHV0aWxzKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGFjdGl2YXRlUm91dGUocm91dGVOYW1lKXtcbiAgICBsZXQgcm91dGUgPSByb3V0ZUNvbmZpZ1tyb3V0ZU5hbWVdO1xuICAgIHJvdXRlICYmIHJvdXRlKCk7ICAgIFxufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUm91dGUoKSB7XG4gICAgbGV0IHJvdXRlTmFtZSA9IGRvY3VtZW50LmxvY2F0aW9uLmhhc2gucmVwbGFjZSgvXiMvLCAnJyk7XG4gICAgaWYocm91dGVOYW1lKSB7XG4gICAgICAgIHV0aWxzLm5hdmlnYXRlVG8ocm91dGVOYW1lKTsgXG4gICAgICAgIGFjdGl2YXRlUm91dGUocm91dGVOYW1lKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBhY3RpdmF0ZVJvdXRlKHJvdXRlTmFtZSk7XG4gICAgfVxufSIsImltcG9ydCB7IHVwZGF0ZVJvdXRlIH0gZnJvbSAnLi9yb3V0ZXIuanMnXG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgdXBkYXRlUm91dGUpO1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2hhc2hjaGFuZ2UnLCB1cGRhdGVSb3V0ZSk7Il19
